---
title: "Preceptor and Population Tables"
author: "David Kane and Aashna Patel"
date: "`r Sys.Date()`"
format: html
execute: 
  echo: false
vignette: >
  %\VignetteIndexEntry{Preceptor and Population Tables}
  %\VignetteEngine{quarto::html}
  %\VignetteEncoding{UTF-8}
---


```{r}
#| message: false
library(tidyverse)
library(primer.tutorials)
```

When you run `primer.tutorials::make_p_tables()`, the following code chunks are placed in the active document.

````{verbatim}
```{r}
# Install the following packages if not already (visit the help page for more details)
install.packages(c("gt", "tibble", "glue"))
```

```{r}
# Edit the following PRECEPTOR/POPULATION footnotes (look at the help page for more details):
pre_title_footnote <- "..."
pre_units_footnote <- "..."
pre_outcome_footnote <- "..."
pre_treatment_footnote <- "..."
pre_covariates_footnote <- "..." 

pop_title_footnote <- "..."
pop_units_footnote <- "..."
pop_outcome_footnote <- "..."
pop_treatment_footnote <- "..."
pop_covariates_footnote <- "..."
```

```{r}
# Use "?" for unknowns in Preceptor Table rows, and "---" for unknowns in Population (data) rows.
# Leave the last row and column as-is to signal more rows exist
p_tibble <- tibble::tribble(
  ~`Unit`, ~`Time/Year`, ~`Potential Outcomes 1`, ~`Potential Outcomes 2`, ~`Treatment`, ~`sex`, ~`age`, ~`incumbent`, ~`More`,
  "...", "2020", "...", "...", "...", "...", "...", "...", "...",
  "...", "2020", "...", "...", "...", "...", "...", "...", "...",
  "...", "2020", "...", "...", "...", "...", "...", "...", "...",
  "...", "...", "...", "...", "...", "...", "...", "...", "..."
)
```

```{r}
d_tibble <- tibble::tribble(
  ~`Source`, ~`Unit`, ~`Time/Year`, ~`Potential Outcomes 1`, ~`Potential Outcomes 2`, ~`Treatment`, ~`sex`, ~`age`, ~`incumbent`, ~`More`,
  "...", "...", "...", "...", "...", "...", "...", "...", "...", "...",
  "Data", "...", "...", "...", "...", "...", "...", "...", "...", "...",
  "Data", "...", "...", "...", "...", "...", "...", "...", "...", "...",
  "Data", "...", "...", "...", "...", "...", "...", "...", "...", "...",
  "Data", "...", "...", "...", "...", "...", "...", "...", "...", "...",
  "...", "...", "...", "...", "...", "...", "...", "...", "...", "...",
  # Reuse preceptor rows from p_tibble
  "Preceptor Table", !!!p_tibble[1, ] |> dplyr::as_tibble() |> dplyr::slice(1) |> unname() |> as.list(),
  "Preceptor Table", !!!p_tibble[2, ] |> dplyr::as_tibble() |> dplyr::slice(1) |> unname() |> as.list(),
  "Preceptor Table", !!!p_tibble[3, ] |> dplyr::as_tibble() |> dplyr::slice(1) |> unname() |> as.list(),
  "Preceptor Table", !!!p_tibble[4, ] |> dplyr::as_tibble() |> dplyr::slice(1) |> unname() |> as.list(),
  "...", "...", "...", "...", "...", "...", "...", "...", "...", "..."
)
```

```{r}
gt::gt(data = p_tibble) |>
  gt::tab_header(title = "Preceptor Table") |>
  gt::tab_spanner(label = "Unit", id = "unit_span", columns = c(`Unit`, `Time/Year`)) |>
  gt::tab_spanner(label = "Potential Outcomes", id = "outcome_span", columns = c(`Potential Outcomes 1`, `Potential Outcomes 2`)) |>
  gt::tab_spanner(label = "Treatment", id = "treatment_span", columns = c(`Treatment`)) |>
  gt::tab_spanner(label = "Covariates", id = "covariates_span", columns = c(`sex`, `age`, `incumbent`)) |>
  gt::cols_align(align = "center", columns = gt::everything()) |>
  gt::cols_align(align = "left", columns = c(`Unit`)) |>
  gt::fmt_markdown(columns = gt::everything()) |>
  gt::tab_footnote(pre_title_footnote, locations = gt::cells_title("title")) |>
  gt::tab_footnote(pre_units_footnote, locations = gt::cells_column_spanners(spanners = "unit_span")) |>
  gt::tab_footnote(pre_outcome_footnote, locations = gt::cells_column_spanners(spanners = "outcome_span")) |>
  gt::tab_footnote(pre_treatment_footnote, locations = gt::cells_column_spanners(spanners = "treatment_span")) |>
  gt::tab_footnote(pre_covariates_footnote, locations = gt::cells_column_spanners(spanners = "covariates_span"))
```

```{r}
gt::gt(data = d_tibble) |>
  gt::tab_header(title = "Population Table") |>
  gt::tab_spanner(label = "Unit/Time", id = "unit_span", columns = c(`Unit`, `Time/Year`)) |>
  gt::tab_spanner(label = "Potential Outcomes", id = "outcome_span", columns = c(`Potential Outcomes 1`, `Potential Outcomes 2`)) |>
  gt::tab_spanner(label = "Treatment", id = "treatment_span", columns = c(`Treatment`)) |>
  gt::tab_spanner(label = "Covariates", id = "covariates_span", columns = c(`sex`, `age`, `incumbent`)) |>
  gt::cols_align(align = "center", columns = gt::everything()) |>
  gt::cols_align(align = "left", columns = c(`Unit`)) |>
  gt::fmt_markdown(columns = gt::everything()) |>
  gt::tab_footnote(pop_title_footnote, locations = gt::cells_title("title")) |>
  gt::tab_footnote(pop_units_footnote, locations = gt::cells_column_spanners(spanners = "unit_span")) |>
  gt::tab_footnote(pop_outcome_footnote, locations = gt::cells_column_spanners(spanners = "outcome_span")) |>
  gt::tab_footnote(pop_treatment_footnote, locations = gt::cells_column_spanners(spanners = "treatment_span")) |>
  gt::tab_footnote(pop_covariates_footnote, locations = gt::cells_column_spanners(spanners = "covariates_span"))
```

```{r}
rm(p_tibble, d_tibble)
```
````

And when you render that document, you will see:

here is my fixed.


show it when rendered