<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Technical Details • primer.tutorials</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Technical Details">
<meta property="og:description" content="primer.tutorials">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">primer.tutorials</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0.9006</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/details.html">Technical Details</a>
    </li>
    <li>
      <a href="../articles/instructions.html">Instructions for Writing Tutorials</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ppbds/primer.tutorials/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="details_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Technical Details</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ppbds/primer.tutorials/blob/master/vignettes/details.Rmd" class="external-link"><code>vignettes/details.Rmd</code></a></small>
      <div class="hidden name"><code>details.Rmd</code></div>

    </div>

    
    
<p>This document reviews some of the technical details behind the special modifications we have made to the basic tutorial technology. It is only of interest to those thinking of modifying the current approach.</p>
<div id="package-locations" class="section level2">
<h2 class="hasAnchor">
<a href="#package-locations" class="anchor" aria-hidden="true"></a>Package locations</h2>
<p>Keep in mind that there are (at least) two versions of <strong>primer.tutorials</strong> installed on your machine. In my case, we have</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a><span class="op">&gt;</span> <span class="ex">/Library/Frameworks/R.framework/Versions/4.1/Resources/library</span></span></code></pre></div>
<p>and</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="op">&gt;</span> <span class="ex">/Users/davidkane/Desktop/projects/primer.tutorials/renv/library/R-4.1/x86_64-apple-darwin17.0/primer.tutorials</span></span></code></pre></div>
<p>The first is the default location for packages. This is where things go unless you do something special. The second is installed in the <code>renv</code> directory which you created within your <code>primer.tutorials</code> project. When you are working in your <code>primer.tutorials</code> project, as you generally will, the <code>renv</code> version of the <strong>primer.tutorials</strong> library is what you will be using.</p>
</div>
<div id="yaml-and-setup-code-chunk" class="section level2">
<h2 class="hasAnchor">
<a href="#yaml-and-setup-code-chunk" class="anchor" aria-hidden="true"></a>YAML and setup code chunk</h2>
<p>The top of your file should look like the text below.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb3-1"><a href="#cb3-1"></a>---</span>
<span id="cb3-2"><a href="#cb3-2"></a>title: "Data API"</span>
<span id="cb3-3"><a href="#cb3-3"></a>tutorial:</span>
<span id="cb3-4"><a href="#cb3-4"></a>  id: "data-api"</span>
<span id="cb3-5"><a href="#cb3-5"></a>output:</span>
<span id="cb3-6"><a href="#cb3-6"></a>  learnr::tutorial:</span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="bn">      progressive: true</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="bn">      allow_skip: true</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>runtime: shiny_prerendered</span>
<span id="cb3-10"><a href="#cb3-10"></a>description: "Working with APIs (application programming interfaces) to download data."</span>
<span id="cb3-11"><a href="#cb3-11"></a>---</span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="bn">```{r setup, include = FALSE}</span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="bn">library(learnr)</span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="bn">library(primer.tutorials)</span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="bn">library(tidyverse)</span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="bn">knitr::opts_chunk$set(echo = FALSE)</span></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="bn">options(tutorial.exercise.timelimit = 60, </span></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="bn">        tutorial.storage = "local") </span></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="bn">```</span></span>
<span id="cb3-21"><a href="#cb3-21"></a></span>
<span id="cb3-22"><a href="#cb3-22"></a><span class="bn">```{js change-code, echo = FALSE}</span></span>
<span id="cb3-23"><a href="#cb3-23"></a></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="bn">function transfer_code(elem){</span></span>
<span id="cb3-25"><a href="#cb3-25"></a><span class="bn">  Shiny.setInputValue("js_to_server", elem.previousElementSibling.dataset.label);</span></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="bn">  </span></span>
<span id="cb3-27"><a href="#cb3-27"></a><span class="bn">}</span></span>
<span id="cb3-28"><a href="#cb3-28"></a></span>
<span id="cb3-29"><a href="#cb3-29"></a><span class="bn">Shiny.addCustomMessageHandler('set-exercise-code', function(x) {</span></span>
<span id="cb3-30"><a href="#cb3-30"></a><span class="bn">  var el = $(`.tutorial-exercise[data-label="${x.label}"] .tutorial-exercise-code-editor`)</span></span>
<span id="cb3-31"><a href="#cb3-31"></a><span class="bn">  var exerciseInput = Shiny.inputBindings.bindingNames["tutorial.exerciseInput"].binding</span></span>
<span id="cb3-32"><a href="#cb3-32"></a><span class="bn">  exerciseInput.setValue(el, {code: x.code});</span></span>
<span id="cb3-33"><a href="#cb3-33"></a><span class="bn">  Shiny.setInputValue("js_to_server", null);</span></span>
<span id="cb3-34"><a href="#cb3-34"></a><span class="bn">})</span></span>
<span id="cb3-35"><a href="#cb3-35"></a><span class="bn">```</span></span>
<span id="cb3-36"><a href="#cb3-36"></a></span>
<span id="cb3-37"><a href="#cb3-37"></a><span class="bn">```{r observe-transfers, context = "server"}</span></span>
<span id="cb3-38"><a href="#cb3-38"></a></span>
<span id="cb3-39"><a href="#cb3-39"></a><span class="bn">observeEvent(input$js_to_server, {</span></span>
<span id="cb3-40"><a href="#cb3-40"></a><span class="bn">  ex_next = input$js_to_server</span></span>
<span id="cb3-41"><a href="#cb3-41"></a><span class="bn">  str_num = parse_integer(gsub("[^0-9]", "", ex_next)) - 1</span></span>
<span id="cb3-42"><a href="#cb3-42"></a><span class="bn">  str_head = gsub("[0-9]", "", ex_next)</span></span>
<span id="cb3-43"><a href="#cb3-43"></a><span class="bn">  ex_prev = paste0(str_head, str_num)</span></span>
<span id="cb3-44"><a href="#cb3-44"></a><span class="bn">  code &lt;- learnr:::get_exercise_submission(session, ex_prev)$data$code %&gt;% trimws()</span></span>
<span id="cb3-45"><a href="#cb3-45"></a><span class="bn">  session$sendCustomMessage("set-exercise-code", list(label = ex_next, code = code))</span></span>
<span id="cb3-46"><a href="#cb3-46"></a><span class="bn">})</span></span>
<span id="cb3-47"><a href="#cb3-47"></a><span class="bn">```</span></span></code></pre></div>
<p>Every tutorial must load the <strong>learnr</strong> package in order to function. <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library(primer.tutorials)</a></code> is always included because it contains the file, <code>submissions_functions.R</code>, which enables answer downloading. All our tutorials need the <strong>tidyverse</strong>. You may need to add other packages which are used in your tutorial. Any such packages also need to be included in the DESCRIPTION file.</p>
<p><code>echo = FALSE</code> is a handy default because, most of the time, we don’t show users the code. Setting the <code>tutorial.exercise.timelimit</code> to 60 seconds is safe, but probably not necessary. <code>tutorial.storage</code> must be set to <code>local</code> to ensure that user work is saved between sessions.</p>
<p>For the setup code chunks, the first chunk is written in javascript and the second is written in R.</p>
<p>The pipeline works as such:</p>
<ol style="list-style-type: decimal">
<li><p>When a button to transfer code is clicked, it triggers the <code>"onclick"</code> event, which calls the function <code>transfer_code()</code>, passing the button element itself as an argument.</p></li>
<li><p><code>transfer_code()</code> is a javascript function defined in the first code chunk that retrieves the current exercise label from an html element after it is compiled. This works by selecting the desired html element relative to the button element passed from the <code>"onclick"</code> event. The function then sets a Shiny server input variable called <code>js_to_server</code> to the current exercise label.</p></li>
<li><p>The action of setting <code>js_to_server</code> to a new variable triggers a Shiny server event defined in the second code chunk. This event gets the previous exercise’s submission and sends that code as well as the current exercise label back to javascript through a custom Shiny message called <code>"set-exercise-code"</code>.</p></li>
<li><p>The message is received in javascript in the first code chunk. Javascript then finds the current code chunk and then <strong>overwrites</strong> the text in the current code chunk with the text from the previous code chunk.</p></li>
</ol>
<p><strong>Process to Current Stage:</strong> This function was suggested by Preceptor for simpler user experience in long tutorials that require pipe-building across multiple exercises. There were 2 main options in achieving this.</p>
<p>First was to have the code of the current exercise automatically copied to user clipboards when clicking the <code>"Run Code"</code> button.</p>
<p>Second was to have the code of the current exercise automatically copied and pasted to the next exercise chunk after some simplified action.</p>
<p>After a swift response from user grrrck on this <a href="https://community.rstudio.com/t/learnr-clipboard-extension/107812" class="external-link">RStudio Community Thread</a>, a clearer direction was laid out. I implemented the answer suggested but Preceptor pointed out that a lot of copy/pasting from the tutorial-maker’s side was required. The problem then was how to minimize the amount of code needed to be repeatedly copied/pasted. Since the answer suggested used actionButtons from Shiny which had little room for customization, we thought there wasn’t a way to know which exercise was locally close to the button.</p>
<p>Therefore, I created a second version that was a bit “brute-force” by having arguments for the code chunks that had the actionButtons, then reading the file itself to find those arguments and extract the labels of the exercise. But that was still a lot of code to copy/paste and God forbid someone wants to insert a new exercise at the beginning because you’ll have to manually change so many exercise names that come after.</p>
<p>Here I realized that I don’t have to use Shiny’s actionButtons and can just use normal html buttons with trigger events that call a javascript function, which can directly communicate with the Shiny server, thus finally reaching the current version. Now no more exercise-specific information needs to be specified, only the exact same button for each exercise.</p>
<p><strong>Possible Improvements:</strong> Personally, I think the current solution is very close to the ideal solution. The only downsides being that 1) tutorial makers still have to include something in the exercises and 2) the button would look much better on the toolbar section of the exercise, next to <code>"Start Over"</code> and where the “hint” would be.</p>
<p>However, the possibility of automatically copying code to clipboard when clicking the <code>"Run Code"</code> button has yet been explored and could offer a better solution.</p>
<div id="rstudio-setting-questions" class="section level3">
<h3 class="hasAnchor">
<a href="#rstudio-setting-questions" class="anchor" aria-hidden="true"></a>RStudio setting questions</h3>
<p>In many settings, it is natural for a set up question to have three parts. First, run a line of code that reports on the value of something. Example:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rstudioapi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rstudioapi/man/readRStudioPreference.html" class="external-link">readRStudioPreference</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"load_workspace"</span>, default <span class="op">=</span> <span class="st">"Code failed."</span><span class="op">)</span></code></pre></div>
<p>This will return TRUE, which is the default value.</p>
<p>Second, change the setting. This generally won’t return anything.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rstudioapi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rstudioapi/man/writeRStudioPreference.html" class="external-link">writeRStudioPreference</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"load_workspace"</span>, value <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>See how the first was “read” and the second was “write”? Then, the third and final step is to confirm that the change worked by re-running the first code again.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rstudioapi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rstudioapi/man/readRStudioPreference.html" class="external-link">readRStudioPreference</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"load_workspace"</span>, default <span class="op">=</span> <span class="st">"Code failed."</span><span class="op">)</span></code></pre></div>
<p>And finish with a sentence that tells the student to notice that the value has changed and that it is now correct. (Of course, we “monitor” that by making them copy/paste this last command and its return from the Console into the tutorial.)</p>
</div>
<div id="other-topics" class="section level3">
<h3 class="hasAnchor">
<a href="#other-topics" class="anchor" aria-hidden="true"></a>Other topics</h3>
<ul>
<li>We can use this trick to add hints to those questions: simply add a <code>&lt;div&gt;</code> tag with an id attribute that marks it as hint for your exercise. Like this:</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb7-1"><a href="#cb7-1"></a>&lt;div id="filter-hint"&gt;</span>
<span id="cb7-2"><a href="#cb7-2"></a>**Hint:** You may want to use the dplyr <span class="bn">`filter`</span> function.</span>
<span id="cb7-3"><a href="#cb7-3"></a>&lt;/div&gt;</span></code></pre></div>
<ul>
<li>Why do we handle images differently from files? The key is the difference between something (like images) which is only needed when the tutorial is being knit and other things (like csv files) which must be accessible during run-time.</li>
</ul>
</div>
<div id="comments-on--rbuildignore" class="section level3">
<h3 class="hasAnchor">
<a href="#comments-on--rbuildignore" class="anchor" aria-hidden="true"></a>Comments on .Rbuildignore</h3>
<p>For some reason, it is impossible to include comments in the .Rbuildignore. Here are some comments on the current version.</p>
<p>The key line is:</p>
<pre><code>tutorials/[^/]*/(?!(images|.*Rmd))</code></pre>
<p>This excludes everything in any subdirectory of the tutorials directory except an images directory (a file named images would also be included) or a file suffixed with “.Rmd”.</p>
<p>This entire document is in Perl-like Regex. The only significant difference from Perl in this document is that “/” do not need to be escaped with a “". The regex below, in plain English, matches (and so excludes) a path which begins with the characters”tutorials/"“, and after those has any number (<em>) of characters except a "/" [^/], and after those has a "/", and after those does not have (?!…) either the characters "images" or (|) any number (</em>) of any character (.) followed by the characters”Rmd". If we used .* instead of defining the character class in [^/]*, the regex would evaluate the negative lookahead after the last “/” in the path. The files within the images directory would then be excluded, because they do neither the characters “images” or a string ending in “Rmd” after their last “/”,</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="http://davidkane.info" class="external-link external-link">David Kane</a>, Becca Gill.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
