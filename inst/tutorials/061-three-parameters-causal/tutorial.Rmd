---
title: 'Three Parameters: Causal'
author: David Kane, Gia Khang and Satvika Upperla
tutorial:
  id: three-parameters-causal
output:
  learnr::tutorial:
    progressive: yes
    allow_skip: yes
runtime: shiny_prerendered
description: 'Chapter 6 Tutorial: Three Parameters: Causal'
---

```{r setup, include = FALSE}
library(learnr)
library(tutorial.helpers)
library(gt)

library(tidyverse)
library(primer.data)
library(tidymodels)
library(broom)
library(marginaleffects)

knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 600, 
        tutorial.storage = "local") 

fit_att <- linear_reg(engine = "lm") |> 
  fit(att_end ~ treatment, data = trains)

comp_att <- avg_comparisons(fit_att, 
			                variables = c("treatment"))
```

```{r copy-code-chunk, child = system.file("child_documents/copy_button.Rmd", package = "tutorial.helpers")}
```

```{r info-section, child = system.file("child_documents/info_section.Rmd", package = "tutorial.helpers")}
```

<!-- DK: This tutorial could use some clean up in the Courage/Temperance sections. -->

## Introduction
### 

This tutorial supports [*Preceptor’s Primer for Bayesian Data Science: Using the Cardinal Virtues for Inference*](https://ppbds.github.io/primer/) by [David Kane](https://davidkane.info/). 

The world confronts us. Make decisions we must.

Imagine that you are you are a campaign manager for a Republican congressional candidate in Georgia. Your goal is to elect your candidate. Your candidate is conservative about immigration. You know that there more conservative a voter is about immigration, the more likely she is to vote for your boss. How should you spend your campaign funds to increase your odds of winning the election?


## The Question
### 

*A prudent question is one half of wisdom.* - Francis Bacon

You have a lot of campaign volunteers. In previous campaigns, you might have had them call voters. But no one answers their phone anymore! What might you have these volunteers do instead? One of your staff mentioned "[Causal effect of intergroup contact on exclusionary attitudes](https://www.pnas.org/doi/10.1073/pnas.1317670111)" by Ryan Enos, an academic article which claims that commuters become more conservative about immigration when they hear Spanish-speakers on their train platform. Making immigration more salient in the up-coming election and making voters more conservative would probably help your candidate. What would happen if you had some of your (Spanish-speaking) volunteers speak Spanish around town?


### Exercise 1

Load [**tidyverse**](https://www.tidyverse.org/) package.

```{r the-question-1, exercise = TRUE}

```

```{r the-question-1-hint-1, eval = FALSE}
library(tidyverse)
```

```{r the-question-1-test, include = FALSE}
library(tidyverse)
```

### 

The `trains` tibble measures attitudes toward immigration among Boston commuters. Individuals were exposed to one of two possible conditions, and then their attitudes towards immigrants were recorded. One condition was waiting on a train platform near individuals speaking Spanish. The other was being on a train platform without Spanish-speakers.



### Exercise 2

Load the [**primer.data**](https://ppbds.github.io/primer.data/) package.

```{r the-question-2, exercise = TRUE}

```

```{r the-question-2-hint-1, eval = FALSE}
library(primer.data)
```

```{r the-question-2-test, include = FALSE}
library(primer.data)
```

### 

The `trains` tibble is available in **primer.data**.

### Exercise 3

After loading **primer.data** in your Console, type `?trains` in the Console, and paste in the Description below.

```{r the-question-3}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### 

The data we have was collected by Enos from commuters on nine train platforms around Boston, Massachusetts in 2012. The data was for attitudes toward immigration-related policies, both before and after an experiment which randomly exposed a treated group to Spanish-speakers on a Boston commuter train platform.

### Exercise 4

Attitude toward immigration is the broad topic of this tutorial. Given that topic, which variable in `trains` should we use as our outcome variable? 

```{r the-question-4}
question_text(NULL,
	message = "`att_end` is the commuter's attitude toward immigration after the experiment.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 2)
```

### 

`att_end` will be our outcome variable, and we will compare it using `treatment`.


```{r}
trains |> 
  ggplot(aes(x = att_end)) +
    geom_bar() +
    labs(title = "Ending Attitude Toward Immigration",
         subtitle = "Integer values ranging from 3 to 15",
         x = "Attitude",
         y = "Count") + 
    scale_x_continuous(breaks = c(3, 5, 7, 9, 11, 13, 15)) +
    theme_classic()
```

*You can never look at your data too much.* Start with the outcome variable.

### Exercise 5

Let's imagine a brand new variable which **does not exists** in the data. This variable should be binary, meaning that it only takes on one of two values. It should also, at least in theory, by manipulable. In other words, if the value of the variable is "X," or whatever, then it generates one potential outcome and if it is "Y," or whatever, it generates another potential outcome.

Describe this imaginary variable and how might we manipulate its value.

For now, ignore the actual treatment variable `treatment` which we will be using later in the analysis. The point of this exercise is to reinforce our understanding of the [Rubin Causal Model](https://ppbds.github.io/primer/rubin-causal-model.html).


```{r the-question-5}
question_text(NULL,
	message = "Imagine a variable called `phone_call` which has a value of `1` if the person received a phone call listing problems with immigration and `0` if they did not receive such a phone call. We, meaning the organization in charge of making such phone calls, can manipulate this variable by deciding, either randomly or otherwise, whether or not we will call a specific individual.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Any data set can be used to construct a causal model as long as there is at least one covariate that we can, at least in theory, manipulate. It does not matter whether or not anyone did, in fact, manipulate it. 

### Exercise 6

Given our (imaginary) treatment variable `phone_call`, how many potential outcomes are there for each person? Explain why.

```{r the-question-6}
question_text(NULL,
	message = "There are two potential outcomes because the treatment variable `phone_call` takes on two possible values: `1` or `0`, i.e., each person either received a phone call or did not.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

The same data set can be used to create, separately, lots and lots of different models, both causal and predictive. We can just use different outcome variables and/or specify different treatment variables. This is a *conceptual* framework we apply to the data. It is never inherent in the data itself.


### Exercise 7

In a few sentences, specify the two different values for the imaginary treatment variable `phone_call`, for a single unit, guess at the potential outcomes which would result, and then determine the causal effect for that unit given those guesses.

```{r the-question-7}
question_text(NULL,
	message = "For a given person, assume that the value of the treatment variable might be `1`` or `0`. If the person gets `1`, then attitude toward immigration would be 9 on a 3 to 15 unit scale. If the person gets `0`, then the attitude would be 7. The causal effect on the outcome of a treatment of `1` versus `0` is `9 - 7` --- i.e., the difference between two potential outcomes --- which equals 2, which is the causal effect.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

The definition of a causal effect is the difference between two potential outcomes. Of course, you can't just say that the causal effect is 2. The exact value depends on which potential outcome comes first in the subtraction and which second. There is, perhaps, a default sense in which the causal effect is defined as treatment minus control. 

Any causal connection means exploring the *within row* difference between two potential outcomes. We don't need to look at any other rows to have that conversation.

### Exercise 8

Let's consider a *predictive* model. Which variable in `trains` do you think might have an important connection to `att_end`? 


```{r the-question-8}
question_text(NULL,
	message = "`sex` might have a connection to `att_end`.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 2)
```

### 

With a predictive model, there is only one outcome for each individual unit. There are not two potential outcomes because we are not considering any of the covariates to be a treatment variable. We assuming that the values of all covariates are "fixed." 

### Exercise 9

Specify two different groups of people which have different values for this new covariate and which might have different average values for the the outcome variable.  (This is fairly obvious, but we want you to write out the logic.)

```{r the-question-9}
question_text(NULL,
	message = "Consider two groups, the first with a value for `sex` of 'Female' and the second with value 'Male'. Those two groups might have different average values for `att_end`.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

In predictive models, do not use words like "cause," "influence," "impact," or anything else which suggests causation. The best phrasing is in terms of "differences" between groups of units with different values for the covariate of interest.

### Exercise 10

Write a causal question which connects the outcome variable `att_end` to `treatment`, the covariate of interest. 

```{r the-question-10}
question_text(NULL,
	message = "What is the average causal effect of exposure to Spanish-speakers on attitudes toward immigration?",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

We call the answer to this question is your "Quantity of Interest." 

Our Quantity of Interest might appear too specific, too narrow to capture the full complexity of the topic. There are many, many numbers which we are interested in, many numbers that we want to know. But we don't need to list them all here! We just need to choose one of them since our goal is just to have a specific number which helps to guide us in the creation of the Preceptor Table and, then, the model.


## Wisdom
### 

*The only true wisdom is in knowing you know nothing.* - Socrates

Our question:

> *What is the average causal effect of exposure to Spanish-speakers on attitudes toward immigration?*

### Exercise 1

In your own words, describe the key components of Wisdom when working on a data science problem.

```{r wisdom-1}
question_text(NULL,
	message = "Wisdom requires the creation of a Preceptor Table, an examination of our data, and a determination, using the concept of validity, as to whether or not we can (reasonably!) assume that the two come from the same population.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

The central problem for Wisdom is: Can we use data from Boston commuters in 2012 to understand the relationship between attitudes toward immigration and exposure to Spanish speakers among Georgia voters today?

### Exercise 2

Define a Preceptor Table.

```{r wisdom-2}
question_text(NULL,
	message = "A Preceptor Table is the smallest possible table of data with rows and columns such that, if there is no missing data, we can easily calculate the quantity of interest.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

The Preceptor Table does not include all the covariates which you will eventually include in your model. It only includes covariates which you need to answer your question.

### Exercise 3

Describe the key components of Preceptor Tables in general, without worrying about this specific problem. Use words like "units," "outcomes," and "covariates."

```{r wisdom-3}
question_text(NULL,
	message = "The rows of the Preceptor Table are the units. The outcome is at least one of the columns. If the problem is causal, there will be at least two (potential) outcome columns. The other columns are covariates. If the problem is causal, at least one of the covariates will considered a treatment.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

This problem is causal so one of the covariates is a treatment. In our problem, the treatment is whether or not the person was exposed to Spanish-speakers. There is a potential outcome for each of the two possible values for the treatment.

### Exercise 4

Create a Github repo called `immigration`. Make sure to click the "Add a README file" check box.

Connect the Github repo to an R project on your computer. Give the R project the same name.

Select `File -> New File -> Quarto Document ...`. Provide a title -- `"Attitudes Toward Immigration"` -- and an author (you). Render the document and save it as `immigration.qmd`.

Edit the `.gitignore` by adding `immigration_files`. Save and push.

In the Console, run:

```         
show_file(".gitignore")
```

CP/CR.

```{r wisdom-4}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 7)
```

### 

We model units, but only we really care about aggregates.

### Exercise 5

What are the units for this problem?

```{r wisdom-5}
question_text(NULL,
	message = "The units are the individual registered voters in our congressional district in Georgia.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Specifying the Preceptor Table forces us to think clearly about the units and the outcomes implied by the question. The resulting discussion sometimes leads us to modify the question with which we started. No data science project follows a single direction. We always backtrack. There is always dialogue.

### Exercise 6

What is the outcome variable for this problem?

```{r wisdom-6}
question_text(NULL,
	message = "`att_end`",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Of course, the outcome we really care about is each person's vote. We aren't being paid to change *attitudes*. We are paid to change *votes*. But the data we have (easy) access to has attitudes, so that is what we will work with. This compromise --- working with what we have rather than what we *really* want is a part of most data science work in the real world.

### Exercise 7

What are some covariates which you think might be useful for this problem, regardless of whether or not they might be included in the data?

```{r wisdom-7}
question_text(NULL,
	message = "Past survey results about immigration, from a year or more ago, might be useful. The data does include `att_start` but that was measured just a few days before the experiment.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

The term "covariates" is used in at least three ways in data science. First, it is all the variables which might be useful, regardless of whether or not we have the data. Second, it is all the variables for which we have data. Third, it is the set of variables in the data which we end up using in the model.

### Exercise 8

What are the treatments, if any, for this problem?

```{r wisdom-8}
question_text(NULL,
	message = "The treatment variable is, conveniently, called `treatment`. Its value is `Treated` if the individual was exposed to Spanish speakers on the train platform and `Control` if the individual was not.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Remember that a treatment is just another covariate which, for the purposes of this specific problem, we are assuming can be manipulated, thereby, creating two different potential outcomes for each unit.

### Exercise 9

What moment in time does the Preceptor Table refer to?

```{r wisdom-9}
question_text(NULL,
	message = "The Preceptor Table is about *now*, the period leading up to the election.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

```{r}
trains |> 
  ggplot(aes(x = att_end, fill = treatment)) +
    geom_bar(aes(y = after_stat(count/sum(count))),
                   position = "dodge") +
    labs(title = "Ending Attitude Toward Immigration",
         subtitle = "Treated Individuals Are More Conservative",
         x = "Attitude",
         y = "Probability",
         fill = NULL) +
    scale_y_continuous(labels = scales::percent_format()) + 
    theme_classic()
```

> *You can never look at the data too much. -- Mark Engerman*

### Exercise 10

Define a causal effect. 

```{r wisdom-10}
question_text(NULL,
	message = "A causal effect is the difference between two potential outcomes.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

According to the Rubin Causal Model, there must be two (or more) potential outcomes for any discussion of causation to make sense. This is simplest to discuss when the treatment only has two different values, thereby generating only two potential outcomes. 

### Exercise 11

What is the fundamental problem of causal inference?

```{r wisdom-11}
question_text(NULL,
	message = "The fundamental problem of causal inference is that we can only observe one potential outcome.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

If the treatment variable is continuous (like income), then there are lots and lots of potential outcomes, one for each possible value of the treatment variable. 

### Exercise 12

How does the motto "No causation without manipulation" apply in this problem?

```{r wisdom-12}
question_text(NULL,
	message = "Because the treatment --- exposure to Spanish speakers --- is something we can manipulate (and something that Enos did, in fact, manipulate), the motto does not apply.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### Exercise 13

Describe in words the Preceptor Table for this problem.

```{r wisdom-13}
question_text(NULL,
	message = "There is a row for each registered voter in the district. There are two columns for potential outcomes: attitude toward immigration if treated and attitude if control. There is one column to indicate which treatment the voter received.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

The Preceptor Table for this problem looks something like this:


```{r}
tibble(ID = c("1", "2", "...", "10", "11", "...", "N"), 
       voting_after_treated = c("3", "10", "...", "5", "5", "...", "8"),
       voting_after_control = c("7", "8", "...", "4", "8", "...", "3"),
       treatment = c("Yes", "No", "...", "Yes", "Yes", "...", "No")) |>
  gt() |> 
  tab_header(title = "Preceptor Table") |>  
  cols_label(ID = md("ID"), 
             voting_after_treated = md("Attitude After Treatment"), 
             voting_after_control = md("Attitude After Control"), 
             treatment = md("Treatment")) |> 
  tab_style(cell_borders(sides = "right"),
            location = cells_body(columns = c(ID))) |> 
  tab_style(style = cell_text(align = "left", v_align = "middle", size = "large"), 
            locations = cells_column_labels(columns = c(ID))) |> 
  cols_align(align = "center", columns = everything()) |> 
  cols_align(align = "left", columns = c(ID)) |> 
  fmt_markdown(columns = everything()) |> 
  tab_spanner(label = "Covariates", columns = c(treatment)) |> 
  tab_spanner(label = "Outcomes", columns = c(voting_after_control, voting_after_treated))
```

The Preceptor Table evolves as we work on the problem. We can calculate the causal effect for each individual as the difference between the two potential outcomes. For Individual 1, the causal effect of treatment is `3 - 7 = -4`. In other words, being exposed to Spanish speakers makes this person have less conservative attitudes toward immigration than they would have otherwise have had.

### Exercise 14

In your QMD, load the **tidyverse** and the **primer.data** packages in a new code chunk. Render the file.

Notice that the file does not look good because the code is visible and there are annoying messages. To take care of this, add `#| message: false` to remove all the messages in the setup chunk. Also add the following to the YAML header to remove all code echos from the whole file:

```         
execute: 
  echo: false
```

In the Console, run:

```         
show_file("analysis.qmd", start = -5)
```

CP/CR.

```{r wisdom-14}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 6)
```

### 

Render again. Everything looks nice because we have added code to make the file look better and more professional.

### Exercise 15

In your own words, define "validity" as we use the term.

```{r wisdom-15}
question_text(NULL,
	message = "Validity is the consistency, or lack thereof, in the columns of the data set and the corresponding columns in the Preceptor Table.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Validity is always about the *columns* in the Preceptor Table and the data. Just because columns from these two different tables have the same *name* does not mean that they are the same *thing*.


### Exercise 16

Provide one reason why the assumption of validity might not hold for the outcome variable `att_end` or for one of the covariates. Use the words "column" or "columns" in your answer.

```{r wisdom-16}
question_text(NULL,
	message = "The attitude toward immigration recorded in the data corresponds to a response to a survey question. In the Preceptor Table, on the other hand, we are not interested in how someone might respond to a survey. After all, people do not always tell the truth in surveys. Instead, we want to know their true, underlying attitude toward immigration.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

In order to consider the Preceptor Table and the data to be drawn from the same population, the columns from one must have a *valid correspondence* with the columns in the other. Validity, if true (or at least reasonable), allows us to construct the Population Table, which is the first step in Justice.

Because we control the Preceptor Table and, to a lesser extent, the original question, we can adjust those variables to be “closer” to the data that we actually have. This is another example of the iterative nature of data science. If the data is not close enough to the question, then we check with our boss/colleague/customer to see if we can modify the question in order to make the match between the data and the Preceptor Table close enough for validity to hold.

### Exercise 17

Over the course of this tutorial, we will be creating a summary paragraph. The purpose of this exercise is to write the first two sentences of that paragraph.

The first sentence is a general statement about the overall topic, mentioning both the general class of the outcome variable and of at least one of the covariates. It is **not** connected to the initial "Imagine that you are ..." which set the stage for this project. That sentence can be rhetorical. It can be trite, or even a platitude. The purpose of the sentence to let the reader know, gently, about our topic.

The second sentence does two things. First, it introduces the data source. Second, it introduces the specific question. The sentence can't be that long. Important aspects of the data include when/where it was gather, how many observations it includes and the organization (if famous) which collected it.

Type your two sentences below.

```{r wisdom-17}
question_text(NULL,
	message = "Attitudes toward immigration are an increasingly important part of US congressional elections. Using data from a 2012 experiment among Boston commuters, we seek to explore the causal effect of exposure to Spanish speakers on attitudes toward immigration among registered voters in Georgia today.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Read our answer. It will not be the same as yours. You can, if you want, change your answer to incorporate some of our ideas. Do not copy/paste our answer exactly. Add your two sentences, edited or otherwise, to your QMD, `Command/Ctrl + Shift + K`, and then commit/push.

## Justice
### 

*Justice is truth in action.* - Benjamin Disraeli

### Exercise 1

In your own words, name the four key components of Justice when working on a data science problem.

```{r justice-1}
question_text(NULL,
	message = "Justice concerns four topics: the Population Table, stability, representativeness, and unconfoundedness.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Justice is about concerns that you (or your critics) might have, reasons why the model you create might not work as well as you hope. 

### Exercise 2

In your own words, define a Population Table.

```{r justice-2}
question_text(NULL,
	message = "The Population Table includes a row for each unit/time combination in the underlying population from which both the Preceptor Table and the data are drawn.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

The Population Table is almost always much bigger than the combination of the Preceptor Table and the data because, if we can really assume that both the Preceptor Table and the data are part of the same population, than that population must cover a broad universe of time and units since the Preceptor Table and the data are, themselves, often far apart from each other.

### Exercise 3

In your own words, define the assumption of "stability" when employed in the context of data science.

```{r justice-3}
question_text(NULL,
	message = "Stability means that the relationship between the columns in the Population Table is the same for three categories of rows: the data, the Preceptor Table, and the larger population from which both are drawn.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Stability is all about *time*. Is the relationship among the columns in the Population Table stable over time? In particular, is the relationship --- which is another way of saying "mathematical formula" --- at the time the data was gathered the same as the relationship at the (generally later) time referenced by the Preceptor Table.

### Exercise 4

Provide one reason why the assumption of stability might not be true in this case.

```{r justice-4}
question_text(NULL,
	message = "The US is a much more Hispanic country today than it was in 2012, so being exposed to Spanish speakers might have a much smaller effect on immigration attitudes today.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

A change in time or the distribution of the data does not, in and of itself, demonstrate a violation of stability. Stability is about the parameters: $\beta_0$, $\beta_1$ and so on. Stability means these parameters are the same in the data as they are in the population as they are in the Preceptor Table.

### Exercise 5

We use our data to make inferences about the overall population. We use information about the population to make inferences about the Preceptor Table: `Data -> Population -> Preceptor Table`. In your own words, define the assumption of "representativeness" when employed in the context of data science.

```{r justice-5}
question_text(NULL,
	message = "Representativeness, or the lack thereof, concerns two relationships among the rows in the Population Table. The first is between the data and the other rows. The second is between the other rows and the Preceptor Table.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Ideally, we would like both the Preceptor Table *and* our data to be random samples from the population. Sadly, this is almost never the case.

### Exercise 6

We do not use the data, directly, to estimate missing values in the Preceptor Table. Instead, we use the data to learn about the overall population. Provide one reason, involving the relationship between the data and the population, for why the assumption of representativeness might not be true in this case. 

```{r justice-6}
question_text(NULL,
	message = "We only have data for Boston commuters. Our population includes people who do not commute. We might have a problem with representativeness if commuters are very different from non-commuters.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

The reason that representativeness is important is because, when it is violated, the estimates for the model parameters might be biased. 

### Exercise 7

We use information about the population to make inferences about the Preceptor Table. Provide one reason, involving the relationship between the population and the Preceptor Table, for why the assumption of representativeness might not be true in this case.

```{r justice-7}
question_text(NULL,
	message = "The Preceptor Table only includes registered voters in one Georgia congressional district. The population includes voters throughout the United States. Georgia is quite different from many other states.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Stability looks across time periods. Representativeness looks within time periods, for the most part. 

### Exercise 8

In your own words, define the assumption of "unconfoundedness" when employed in the context of data science.

```{r justice-8}
question_text(NULL,
	message = "Unconfoundedness means that the treatment assignment is independent of the potential outcomes, when we condition on pre-treatment covariates.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

This assumption is only relevant for causal models. We describe a model as "confounded" if this is not true. The easiest way to ensure unconfoundedness is to assign treatment randomly.

### Exercise 9

Provide one reason why the assumption of unconfoundedness might not be true (or relevant) in this case.

```{r justice-9}
question_text(NULL,
	message = "Although the exposure to Spanish-speakers is randomized, the difficulty of ensuring that this exposure might have caused problems. For example, what if some people are more likely to move away from strangers than others? In that case, those people, moving away from the experimenters, might never have heard any Spanish, even though they were officially 'assigned' to the treatment.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

The great advantage of randomized assignment of treatment is that it guarantees unconfoundedness. There is no way for treatment assignment to be correlated with anything, including potential outcomes, if treatment assignment is random, and *if the experimental set up worked as designed.* Sadly, in the real world, there are sometimes problems.

### Exercise 10

Write one sentence which highlights a potential weakness in your model. This will almost always be derived from possible problems with the assumptions discussed above. We will add this sentence to our summary paragraph. So far, our version of the summary paragraph looks like this:

> Attitudes toward immigration are an increasingly important part of US congressional elections. Using data from a 2012 experiment among Boston commuters, we seek to explore the causal effect of exposure to Spanish speakers on attitudes toward immigration among registered voters in Georgia today.

Of course, your version will be somewhat different.

```{r justice-10}
question_text(NULL,
	message = "The relationship between exposure to Spanish speakers and attitudes toward immigration may have changed since 2012.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Add a weakness sentence to the summary paragraph in your QMD. You can modify your paragraph as you see fit, but do not copy/paste our answer exactly. `Command/Ctrl + Shift + K`, and then commit/push.


## Courage
### 

*Courage is found in unlikely places.* - J.R.R. Tolkien

### Exercise 1

In your own words, describe the components of the virtue of Courage for analyzing data.

```{r courage-1}
question_text(NULL,
	message = "Courage starts with math, explores models, and then creates the data generating mechanism.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

A statistical model consists of two parts: the *probability family* and the *link function*. The probability family is the probability distribution which generates the randomness in our data. The link function is the mathematical formula which links our data to the unknown parameters in the probability distribution. 

### Exercise 2

Load the [**tidymodels**](https://www.tidymodels.org/) package.

```{r courage-2, exercise = TRUE}

```

```{r courage-2-hint-1, eval = FALSE}
library(...)
```

```{r courage-2-test, include = FALSE}
library(tidymodels)
```

### 

The probability family is determined by the outcome variable $Y$. 

If $Y$ is a continuous variable, the probability family is Normal, also known as Gaussian.

$$Y \sim N(\mu, \sigma^2)$$

`att_end` is not exactly continuous. It takes on integer values from 3 to 15. But it is continuous *enough* that using the Normal probability for the error term makes sense.

### Exercise 3

Load the [**gtsummary**](https://www.danieldsjoberg.com/gtsummary/) package.

```{r courage-3, exercise = TRUE}

```

```{r courage-3-hint-1, eval = FALSE}
library(...)
```

```{r courage-3-test, include = FALSE}
library(gtsummary)
```

### 

The link function, the basic mathematical structure of the model, is (mostly) determined by the type of outcome variable. 

For a continuous outcome variable, we use a linear model for the link function:

$$\mu = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \ldots$$

In this case, we model `att_end` as a linear function of covariates, most importantly `treatment`.

### Exercise 4

Use AI to come up with a $\LaTeX$ representation of the mathematical structure of the model, with `att_end` as the dependent variable and `treatment` as the independent variable. This version will not have the values of any parameters since we have not, yet, estimated them. Confirm that the code works by placing it in your QMD and then rendering. Paste that $\LaTeX$ code below.

```{r courage-4}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 5)
```

###


$$\text{att_end} = \beta_0 + \beta_1 \cdot \text{treatment}_{\text{Treated}} + \epsilon$$

with $\epsilon \sim N(\mu, \sigma^2)$. This was generated by

````
$$\text{att_end} = \beta_0 + \beta_1 \cdot \text{treatment}_{\text{Treated}} + \epsilon$$

with $\epsilon \sim N(\mu, \sigma^2)$.
````

Recall that a categorical variable (whether character or factor) like `sex` is turned into a $0/1$ "dummy" variable which is then re-named something like $sex_{Male}$. After all, we can't have words --- like "Male" or "Female" --- in a mathematical formula, hence the need for dummy variables.

The same reasoning applies to `treatment` because it is not a numerical value. It is a character or factor variable, so we need to create a new 0/1 variable, $\text{treatment}_{\text{Treated}}$, so that it can be included in a mathematical formula.


### Exercise 5

Add `library(tidymodels)`, `library(gtsummary)`, and `library(marginaleffects)` to the `setup` code chunk in your QMD. `Command/Ctrl + Shift + K`.

At the Console, run:

```
tutorial.helpers::show_file("immigration.qmd", pattern = "tidymodels|gtsummary|marginaleffects")
```

CP/CR.

```{r courage-5}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### 

Since $\text{treatment}_{\text{Treated}}$ is equal to zero for people who receive the control, we can interpret the intercept of the model, $\beta_0$, as the expected value of `att_end` for members of the control group.

### Exercise 6

Because our outcome variable is continuous, start to create the model by using `linear_reg(engine = "lm")`.

```{r courage-6, exercise = TRUE}

```

```{r courage-6-hint-1, eval = FALSE}
linear_reg(engine = "lm")
```

```{r courage-6-test, include = FALSE}
linear_reg(engine = "lm")
```

### 

The same approach applies to a categorical covariate with $N$ values. Such cases produce $N-1$ dummy $0/1$ variables. The presence of an intercept in most models means that we can't have $N$ categories. The "missing" category is incorporated into the intercept. If `race` has three values --- "black", "hispanic", and "white" --- then the model creates two 0/1 dummy variables, giving them names like $race_{hispanic}$ and $race_{white}$. The results for the *first* category are included in the intercept, which becomes the reference case, relative to which the other coefficients are applied.

But, in this case, `treatment` only has two values, which are also known as "levels."

### Exercise 7

Continue the pipe with `fit(att_end ~ treatment, data = trains)`.

```{r courage-7, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r courage-7-hint-1, eval = FALSE}
... |> 
  fit(..., data = ...)
```

```{r courage-7-test, include = FALSE}
linear_reg(engine = "lm") |> 
    fit(att_end ~ treatment, data = trains)
```

### 

This should produce:

```{r}
linear_reg(engine = "lm") |> 
    fit(att_end ~ treatment, data = trains)
```

The process of "fitting" a model involves estimating the value of our three unknown parameters: $\beta_0$, $\beta_1$, and $\sigma$. The estimated values for $\beta_0$ and $\beta_1$ are shown in the display above. You can access the estimated value of $\sigma$ from the fitted object, but, for the most part, we don't care since $\sigma$ is a "nuisance" parameter, a parameter with no real meaning and which we are, therefore, not really interested in.

### Exercise 8

Behind the scenes of this tutorial, an object called `fit_att` has been created which is the result of the code above. Type `fit_att` and hit "Run Code." This generates the same results as using `print(fit_att)`.


```{r courage-8, exercise = TRUE}

```

```{r courage-8-hint-1, eval = FALSE}
fit_att
```

```{r courage-8-test, include = FALSE}
fit_att
```

### 

In data science, **we deal with words, math, and code, but the most important of these is code.** We created the mathematical structure of the model and then wrote a model formula in order to estimate the unknown parameters. 


### Exercise 9

Create a new code chunk in your QMD. Add a code chunk option: `cache: true`. Copy/paste the code from above for estimating the model into the code chunk, assigning the result to `fit_att`. 

`Command/Ctrl + Shift + K`. It may take some time to render your QMD, depending on how complex your model is. But, by including `cache: true` you cause Quarto to cache the results of the chunk. The next time you render your QMD, as long as you have not changed the code, Quarto will just load up the saved fitted object.

To confirm, `Command/Ctrl + Shift + K` again. It should be quick.

At the Console, run:

```
tutorial.helpers::show_file("immigration.qmd", start = -8)
```

CP/CR.

```{r courage-9}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 8)
```

### 

<!-- DK: Should this be a separate question? -->

Add `*_cache` to `.gitignore` file. Commit and push. Cached objects are often large. They don't belong on Github.

### Exercise 10

Pass the $\LaTeX$ from the basic model you created above and the result of the fitting process to an AI and ask it for the $\LaTeX$ for the fitted model. Add it to your QMD.

`Command/Ctrl + Shift + K` to make sure it works. Fit it if not. 

At the Console, run:

```
tutorial.helpers::show_file("immigration.qmd", start = -3)
```

CP/CR.

```{r courage-10}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### 

Our formula looks like:

$$\widehat{\text{att_end}} = 8.45 + 1.55 \cdot \text{treatment}_{\text{Treated}}$$

It was created with:

````
$$\widehat{\text{att_end}} = 8.45 + 1.55 \cdot \text{treatment}_{\text{Treated}}$$
````

Note the differences. First, we have replaced the parameters with our best estimates. Second, we have dropped the error term because this is a formula for predicting the value for `att_end`. Third, the left-hand side variable is $\widehat{\text{att_end}}$ instead of $\text{att_end}$ because this formula generates our estimated `att_end`. A hat indicates an estimated value.

This is our data generating mechanism.

### Exercise 11

Run `tidy()` on `fit_att` with the argument `conf.int` set equal to `TRUE`. The returns 95% intervals for all the parameters in our model.

```{r courage-11, exercise = TRUE}

```

```{r courage-11-hint-1, eval = FALSE}
tidy(..., conf.int = ...)
```

```{r courage-11-test, include = FALSE}
tidy(fit_att, conf.int = TRUE)
```

### 

`tidy()` is part of the [**broom**](https://broom.tidymodels.org/) package, used to summarize information from a wide variety of models.

### Exercise 12

For interactive use, `tidy()` is very handy. But, for presenting our results, we should use a presentation package like **gtsummary**, which includes handy functions like `tbl_regression()`.

Run `tbl_regression(fit_att)`.


```{r courage-12, exercise = TRUE}

```

```{r courage-12-hint-1, eval = FALSE}
tbl_regression(..)
```

```{r courage-12-test, include = FALSE}
tbl_regression(fit_att)
```

### 

See this [tutorial](https://www.danieldsjoberg.com/gtsummary/articles/tbl_regression.html) for a variety of options for customizing your table.

### Exercise 13

Create a new code chunk in your QMD. Add this code to the code chunk.

```
tbl_regression(fit_att)
```

`Command/Ctrl + Shift + K`. 

At the Console, run:

```
tutorial.helpers::show_file("immigration.qmd", pattern = "tbl_regression")
```

CP/CR.

```{r courage-13}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

Ask AI for advice on how to make the table look more professional. At the very least, include a title and a caption with the data source. The more you use AI, the better you will get at doing so.

### Exercise 14

Add a sentence to your project summary. 

Explain the structure of the model. Something like: "I/we model Y [the concept of the outcome, not the variable name], [insert description of values of Y], as a [linear/logistic/multinomial/ordinal] function of X [and maybe other covariates]." 

Recall the beginning of our version of the summary:

> Attitudes toward immigration are an increasingly important part of US congressional elections. Using data from a 2012 experiment among Boston commuters, we seek to explore the causal effect of exposure to Spanish speakers on attitudes toward immigration among registered voters in Georgia today.

```{r courage-14}
question_text(NULL,
	message = "We model attitude toward immigration, an integer value ranging from 3 to 15, as a linear function of exposure to Spanish speakers.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Read our answer. It will not be the same as yours. You can, if you want, change your answer to incorporate some of our ideas. Do not copy/paste our answer exactly. Add your two sentences, edited or otherwise, to the summary paragraph portion of your QMD. `Command/Ctrl + Shift + K`, and then commit/push.

## Temperance
### 

*Temperance is a tree which has for its root very little contentment, and for its fruit calm and peace.* - Buddha

### Exercise 1

In your own words, describe the use of Temperance in data science.

```{r temperance-1}
question_text(NULL,
	message = "Temperance uses the data generating mechanism to answer the question with which we began. Humility reminds us that this answer is always a lie. We can also use the DGM to calculate many similar quantities of interest, displaying the results graphically.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Courage gave us the data generating mechanism. Temperance guides us in the use of the DGM — or the “model” — we have created to answer the questions with which we began. We create posteriors for the quantities of interest. 

### Exercise 2

Before using the DGM, we should make sure that we can interpret it.

Recall the values for the parameters in our data generating mechanism:

```{r}
tidy(fit_att, conf.int = TRUE)
```

Write a sentence interpreting the 8.45 estimate for the intercept.

```{r temperance-2}
question_text(NULL,
	message = "For an individual who receives the control, the value of treatmentTreated is zero, so the best forecast for their attitude toward immigration after the experiment is 8.45.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

###

Most of the time parameters in a model have no direct relationship with any population value in which we might be interested. This is especially true in complex and/or non-linear models. That is, in those cases, a coefficient like $\beta_0$ does not "mean" anything. But, in simple, small, linear models, like this one, $\beta_0$ does correspond to something real.

### Exercise 3

```{r}
tidy(fit_att, conf.int = TRUE)
```

Interpret the 1.55 estimate for `treatmentTreated`.

```{r temperance-3}
question_text(NULL,
	message = "The average causal effect of receiving the treatment of hearing Spanish-speakers on the train platform, relative to the control, is to have a 1.55  higher value for `att_end`, meaning that the treatment, relative to the control, makes one more conservative about immigration.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

###

The interpretation of a treatment variable is very different than the interpretation of a standard covariate. The key point is that there is no such thing as a causal (versus preditive) data set nor a causal (versus predictive) R code formula. You can use the same data set (and the same R code!) for both causal and predictive models. The difference lies in the assumptions you make.

### Exercise 4

```{r}
tidy(fit_att, conf.int = TRUE)
```

Interpret the 0.52 to 2.97 interval for the `treatmentTreated` coefficient.

```{r temperance-4}
question_text(NULL,
	message = "Our best estimate for the average causal effect is 1.55, meaning that being treated makes someone 1.55 units more conservative about immigration. Yet, the true value could be lower or higher. We are 95% certain that the true effect is somewhere between 0.52 to 2.97.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

###

We look for two things in the confidence interval. First, does it exclude zero? If not, then we can't be sure if the relationship is positive or negative. Second, does it overlap with the confidence intervals for other dummy columns derived from this variable? If so, then we can be sure that the ordering as to which comparisons are bigger.

### Exercise 5

What is the specific question we are trying to answer? 

```{r temperance-5}
question_text(NULL,
	message = "What is the average causal effect of exposure to Spanish-speakers on attitudes toward immigration?",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Data science projects almost always begin with a broad topic of interest. Yet, in order to make progress, we need to drill down to a specific question. This leads to the creation of a data generating mechanism, which can now be used to answer lots of questions, thus allowing us to explore the original topic more broadly.

### Exercise 6

In the end, we don't really care about parameters, much less how to interpret them. Parameters are *imaginary*, like unicorns. We care about answers to our questions. Parameters are tools for answering questions. They aren't interesting in-and-of themselves. *In the modern world, all parameters are nuisance parameters.* 

Load the [**marginaleffects**](https://marginaleffects.com/) package.

```{r temperance-6, exercise = TRUE}

```

```{r temperance-6-hint-1, eval = FALSE}
library(...)
```

```{r temperance-6-test, include = FALSE}
library(marginaleffects)
```

### 

We should be modest in the claims we make. The posteriors we create are never the “truth.” The assumptions we made to create the model are never perfect. Yet decisions made with flawed posteriors are almost always better than decisions made without them.

### Exercise 7

Run this code:

```
avg_comparisons(fit_att, 
                variables = c("treatment"))
```             


```{r temperance-7, exercise = TRUE}

```

```{r temperance-7-test, include = FALSE}
avg_comparisons(fit_att, 
                variables = c("treatment"))
```

###

`avg_comparisons()` subtracts the average `att_end` for controls from the average `att_end` for the treated, and also provides the associated uncertainty for that estimate. `Error` refers to the standard error. Note how the 95% confidence interval is approximately equal to $\pm 2$ standard errors.

### Exercise 8

Behind the scenes, we have assigned the result of this function to a new object: `comp_att`.

At the Console, type `comp_att` to examine it. CP/CR.

```{r temperance-8}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 7)
```

###

When adding code like this to your QMD you can follow two strategies. First, you can build things step-by-step, creating and saving interim objects like `fit_att` and `comp_att`. Second, you can just build one big pipe which finishes by creating your final graphic.

### Exercise 9

We would like to use `plot_comparisons()` to show a simple plot of the posterior of the causal effect, but, [unfortunately](https://github.com/vincentarelbundock/marginaleffects/discussions/1450), `plot_comparisons()` does not work well for such a simple model. Instead, show an AI the `comp_att` object and ask it for a nice looking plot. For example, we asked:

````
Using the marginaleffects package in R, we create this object.

> fit_att <- linear_reg(engine = "lm") |> 
+   fit(att_end ~ treatment, data = trains)
+ 
+ comp_att <- avg_comparisons(fit_att, 
+                 variables = c("treatment"))
> comp_att

 Estimate Std. Error    z Pr(>|z|)   S 2.5 % 97.5 %
     1.55      0.521 2.97  0.00301 8.4 0.525   2.57

Term: treatment
Type:  numeric 
Comparison: Treated - Control
>

Create a nice looking ggplot2 using comp_att. 
````

We then went back-and-forth a few times. Confirm that your plot code works well in the Console -- which already has libraries like **tidyverse** loaded and objects like `comp_att` created. 

Paste your code here:

```{r temperance-9}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 20)
```

###

We created:

```{r}
ggplot(comp_att, aes(x = "", y = estimate)) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray60") +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high), 
                width = 0.1, linewidth = 0.8) +
  geom_point(size = 3, color = "blue") +
  coord_flip() +
  labs(
    title = "Causal Effect of Treatment on Attitude Toward Immigration",
    subtitle = "Exposure to Spanish speakers makes Boston commuters more conservative.",
    x = "",
    y = "Effect Size",
    caption = "From Enos (2014). Attitude measured on a 3 - 15 integer scale\nwith larger numbers indicating more conservative attitudes."
  ) +
  theme_minimal() +
  theme(axis.text.y = element_blank())
```

From:

````
ggplot(comp_att, aes(x = "", y = estimate)) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray60") +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high), 
                width = 0.1, linewidth = 0.8) +
  geom_point(size = 3, color = "blue") +
  coord_flip() +
  labs(
    title = "Causal Effect of Treatment on Attitude Toward Immigration",
    subtitle = "Exposure to Spanish speakers makes Boston commuters more conservative.",
    x = "",
    y = "Effect Size",
    caption = "From Enos (2014). Attitude measured on a 3 - 15 integer scale\nwith larger numbers indicating more conservative attitudes."
  ) +
  theme_minimal() +
  theme(axis.text.y = element_blank())
````

###

Again, we went back-and-forth with the AI to create this. In fact, we had to write the titles and caption by hand, something that AIs often have trouble with.

### Exercise 10

Create a new code chunk in your QMD. Copy/paste the code which creates your graphic. 

`Command/Ctrl + Shift + K` to ensure that it all works as intended.

At the Console, run:

```
tutorial.helpers::show_file("immigration.qmd", start = -8)
```

CP/CR.

```{r temperance-10}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 10)
```

### 

Data science often involves this-back-and-forth style of work. First, we need to make a single chunk of code, in this case, a new plot, work well. This requires interactive work between the QMD and the Console. Second, we need to ensure that the entire QMD runs correctly on its own.


### Exercise 11

Write the last sentence of your summary paragraph. It describes at least one quantity of interest (QoI) and provides a measure of uncertainty about that QoI. (It is OK if this QoI is not the one that you began with. The focus of a data science project often changes over time.)


```{r temperance-11}
question_text(NULL,
	message = "Briefly exposing voters to Spanish speakers makes them more conservative on immigration, by about 1.5 (plus/minus 1), on a 3 -15 scale, which is about 2/3s of the difference between Democrats and Republicans.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Add a final sentence to your summary paragraph in your QMD as you see fit, but do not copy/paste our answer exactly. `Command/Ctrl + Shift + K`.

### Exercise 12

Write a few sentences which explain why the estimates for the quantities of interest, and the uncertainty thereof, might be wrong. Suggest an alternative estimate and confidence interval, if you think either might be warranted.

```{r temperance-12}
question_text(NULL,
	message = "The fundamental problem with this model is that, what we really care about is voting behavior. But the outcome we actually have data for is attitude toward immigration. We suspect that these things are correlated, that people with more conservative attitudes are more likely to vote Republican, but we have no data which demonstrates that.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Always go back to your Preceptor Table, the information which, if you had it, would make answering your question easy. In almost all real world cases, the Preceptor Table and the data are fairly different, not least because validity never holds perfectly. So, even a perfectly estimated statistical model is rarely as useful as we might like.

### Exercise 13

Rearrange the material in your QMD so that the order is graphic, followed by paragraph.  Doing so, of course, requires sensible judgment. For example, the code chunk which creates the fitted model must occur before the chunk which creates the graphic. You can keep or discard the math and any other material at your own discretion.

`Command/Ctrl + Shift + K` to ensure that everything works.

At the Console, run:

```
tutorial.helpers::show_file("immigration.qmd")
```

CP/CR.

```{r temperance-13}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 30)
```

### 

This is the version of your QMD file which your teacher is most likely to take a close look at.

### Exercise 14

Publish your rendered QMD to GitHub Pages. Copy/paste the resulting url below.

```{r temperance-14}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### 

Commit/push everything.

### Exercise 15

Copy/paste the url to your Github repo.

```{r temperance-15}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### 

We can never know all the entries in the Preceptor Table. That knowledge is reserved for God. If all our assumptions are correct, then our DGM is true, it accurately describes the way in which the world works. There is no better way to predict the future, or to model the past, than to use it. Sadly, this will only be the case with toy examples involving things like coins and dice. We hope that our DGM is close to the true DGM but, since our assumption are never perfectly correct, our DGM will always be different. The estimated magnitude and importance of that difference is a matter of judgment.

The world confronts us. Make decisions we must.

## Summary
### 

This tutorial supports [*Preceptor’s Primer for Bayesian Data Science: Using the Cardinal Virtues for Inference*](https://ppbds.github.io/primer/) by [David Kane](https://davidkane.info/). 

Our results:

```{r}
ggplot(comp_att, aes(x = "", y = estimate)) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray60") +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high), 
                width = 0.1, linewidth = 0.8) +
  geom_point(size = 3, color = "blue") +
  coord_flip() +
  labs(
    title = "Causal Effect of Treatment on Attitude Toward Immigration",
    subtitle = "Exposure to Spanish speakers makes Boston commuters more conservative.",
    x = "",
    y = "Effect Size",
    caption = "From Enos (2014). Attitude measured on a 3 - 15 integer scale\nwith larger numbers indicating more conservative attitudes."
  ) +
  theme_minimal() +
  theme(axis.text.y = element_blank())
```




$$\widehat{\text{att_end}} = 8.45 + 1.55 \cdot \text{treatment}_{\text{Treated}}$$


<!-- DK: Give our final plot, summary paragraph and mathematical formula. And a note indicating how this information might be helpful to the Imagine person we created at the start. -->


```{r download-answers, child = system.file("child_documents/download_answers.Rmd", package = "tutorial.helpers")}
```
